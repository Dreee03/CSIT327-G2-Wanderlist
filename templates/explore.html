{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Explore | WanderList</title>
  
  <link rel="stylesheet" href="{% static 'css/theme.css' %}">
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <style>
    /* Page Layout Adjustments */
    body {
      background-color: #f8f9fa;
      padding-top: 0; /* Navbar is sticky in dashboard.css */
    }

    /* Main Container */
    .explore-container {
      max-width: 1400px; /* Wide enough for 5 cards */
      margin: 0 auto;
      padding: 30px 24px;
    }

    .explore-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .explore-header h2 {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--wl-deep);
      margin-bottom: 8px;
    }
    .explore-header p {
      color: var(--wl-muted);
      font-size: 1.1rem;
    }

    /* ✅ GRID LAYOUT (The Request) */
    .explore-grid {
      display: grid;
      /* This magic line makes it responsive. 
         - 230px minimum width per card.
         - auto-fill fits as many as possible (approx 5 on desktop).
         - 1fr stretches them to fill space.
      */
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 24px;
    }

    /* Card Styling */
    .explore-card {
      background: #fff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
      position: relative;
      border: 1px solid rgba(0,0,0,0.03);
    }

    .explore-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.12);
    }

    .explore-card img {
      width: 100%;
      height: 180px; /* Consistent height for neat rows */
      object-fit: cover;
    }

    .explore-card .card-body {
      padding: 16px;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }

    .explore-card h4 {
      font-size: 1.15rem;
      font-weight: 700;
      margin: 0 0 6px 0;
      color: var(--wl-text);
    }

    .explore-card p {
      font-size: 0.9rem;
      color: #666;
      line-height: 1.5;
      margin-bottom: 16px;
      flex-grow: 1;
    }

    .card-footer-custom {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      padding-top: 12px;
      border-top: 1px solid #f0f0f0;
    }

    .location-text {
      font-size: 0.85rem;
      color: var(--wl-muted);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .btn-add {
      background: var(--wl-primary);
      color: white;
      border: none;
      padding: 6px 16px;
      border-radius: 50px;
      font-size: 0.85rem;
      font-weight: 600;
      text-decoration: none;
      transition: background 0.2s;
      cursor: pointer;
    }
    .btn-add:hover {
      background: var(--wl-primary-700);
      color: white;
    }

    /* Floating Chooser (Quick Add) */
    .floating-chooser {
      position: absolute; 
      background: #fff; 
      border:1px solid rgba(0,0,0,0.08); 
      box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
      border-radius:12px; 
      padding:8px; 
      z-index:1200;
      display:flex; 
      flex-direction: column;
      gap:6px; 
      min-width: 140px;
      animation: fadeIn 0.2s ease;
    }
    .chooser-btn { 
      padding:8px 12px; 
      border-radius:8px; 
      border:none; 
      cursor:pointer; 
      font-weight:600; 
      text-align: left;
      font-size: 0.9rem;
      background: transparent;
      transition: background 0.1s;
    }
    .chooser-btn:hover { background: #f3f4f6; }
    .chooser-btn.planned { color: var(--wl-primary); }
    .chooser-btn.visited { color: #10b981; }
    .chooser-btn.dreaming { color: #8b5cf6; }
    .chooser-title {
        font-size: 0.75rem; color: #999; padding: 4px 8px; font-weight: 600; text-transform: uppercase;
    }

    @keyframes fadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }
  </style>
</head>
<body>

  <header class="navbar">
    <div class="nav-left">
      <a href="{% url 'dashboard' %}" class="logo-text">WanderList</a>
      <a href="{% url 'dashboard' %}" class="nav-link">Dashboard</a>
      <a href="{% url 'destination:list' %}" class="nav-link">Destinations</a>
      <a href="{% url 'my_lists' %}" class="nav-link">My Maps</a>
      <a href="{% url 'destination:explore' %}" class="nav-link active">Explore</a>
      <a href="{% url 'schedule_events:calendar' %}" class="nav-link">Calendar</a>
    </div>

    <div class="nav-right">
      <a href="{% url 'profile' %}">
        {% static 'images/profile.jpg' as default_profile %}
        <img class="profile" src="{{ profile.profile_pic.url|default:default_profile }}" alt="{{ user.username }}">
      </a>
    </div>
  </header>

  <main class="explore-container">
    <div class="explore-header">
      <h2>Explore the World</h2>
      <p>Discover new places and add them to your lists instantly.</p>
    </div>

    <div class="explore-grid">
      
      <article class="explore-card" data-name="Paris" data-city="Paris" data-country="France">
        <img src="{% static 'images/paris.jpg' %}" alt="Paris" onerror="this.src='https://images.unsplash.com/photo-1502602898657-3e91760cbb34?auto=format&fit=crop&w=800&q=80'">
        <div class="card-body">
          <h4>Paris</h4>
          <p>The City of Lights: art, cafés, and timeless architecture. Perfect for romantic strolls.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> France</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="Tokyo" data-city="Tokyo" data-country="Japan">
        <img src="{% static 'images/tokyo.jpg' %}" alt="Tokyo" onerror="this.src='https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=800&q=80'">
        <div class="card-body">
          <h4>Tokyo</h4>
          <p>A dazzling blend of the modern and the traditional — neon districts and temples.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> Japan</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="New York" data-city="New York" data-country="USA">
        <img src="{% static 'images/newyork.jpg' %}" alt="New York" onerror="this.src='https://images.unsplash.com/photo-1496442226666-8d4a0e62e6e9?auto=format&fit=crop&w=800&q=80'">
        <div class="card-body">
          <h4>New York</h4>
          <p>The city that never sleeps — skyline views and endless neighborhoods.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> USA</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="Santorini" data-city="Oia" data-country="Greece">
        <img src="https://images.unsplash.com/photo-1570077188670-e3a8d69ac5ff?auto=format&fit=crop&w=800&q=80" alt="Santorini">
        <div class="card-body">
          <h4>Santorini</h4>
          <p>Iconic whitewashed towns and caldera views. Perfect for sunsets.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> Greece</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="Reykjavík" data-city="Reykjavík" data-country="Iceland">
        <img src="https://images.unsplash.com/photo-1476610182048-b716b8518aae?auto=format&fit=crop&w=800&q=80" alt="Reykjavík">
        <div class="card-body">
          <h4>Reykjavík</h4>
          <p>Gateway to glaciers, hot springs and the Northern Lights.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> Iceland</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="Bali" data-city="Ubud" data-country="Indonesia">
        <img src="https://images.unsplash.com/photo-1537996194471-e657df975ab4?auto=format&fit=crop&w=800&q=80" alt="Bali">
        <div class="card-body">
          <h4>Bali</h4>
          <p>Lush rice terraces, temples, and surf — an island of culture.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> Indonesia</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="Sydney" data-city="Sydney" data-country="Australia">
        <img src="https://images.unsplash.com/photo-1506973035872-a4ec16b8e8d9?auto=format&fit=crop&w=800&q=80" alt="Sydney">
        <div class="card-body">
          <h4>Sydney</h4>
          <p>Harbour views, vibrant beaches and iconic architecture.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> Australia</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="Barcelona" data-city="Barcelona" data-country="Spain">
        <img src="https://images.unsplash.com/photo-1583422409516-2895a77efded?auto=format&fit=crop&w=800&q=80" alt="Barcelona">
        <div class="card-body">
          <h4>Barcelona</h4>
          <p>Gaudí architecture, tapas and beaches — a city full of life.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> Spain</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="Cape Town" data-city="Cape Town" data-country="South Africa">
        <img src="https://images.unsplash.com/photo-1580060839134-75a5edca2e99?auto=format&fit=crop&w=800&q=80" alt="Cape Town">
        <div class="card-body">
          <h4>Cape Town</h4>
          <p>Coastal scenery, Table Mountain, and wineries.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> South Africa</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

      <article class="explore-card" data-name="Lisbon" data-city="Lisbon" data-country="Portugal">
        <img src="https://images.unsplash.com/photo-1590422749842-70b9df42b03a?auto=format&fit=crop&w=800&q=80" alt="Lisbon">
        <div class="card-body">
          <h4>Lisbon</h4>
          <p>Hills, trams and seaside viewpoints — colorful streets.</p>
          <div class="card-footer-custom">
            <span class="location-text"><i class="bi bi-geo-alt-fill"></i> Portugal</span>
            <button class="btn-add">Add +</button>
          </div>
        </div>
      </article>

    </div>
  </main>

  <form id="hidden_add_form" method="POST" action="{% url 'destination:create' %}" style="display:none;">
    {% csrf_token %}
    <input name="name" id="hidden_name">
    <input name="city" id="hidden_city">
    <input name="country" id="hidden_country">
    <input name="destination_image" id="hidden_image">
    <input name="latitude" id="hidden_lat" value="0">
    <input name="longitude" id="hidden_lon" value="0">
    <input name="notes" id="hidden_notes" value="">
    <input name="category" id="hidden_category">
  </form>

  <script>
    (function(){
      // Create chooser element
      const chooser = document.createElement('div');
      chooser.className = 'floating-chooser';
      chooser.style.display = 'none';
      chooser.innerHTML = `
        <div class="chooser-title">Add to List</div>
        <button class="chooser-btn planned" data-cat="Planned"><i class="bi bi-calendar-event"></i> Planned</button>
        <button class="chooser-btn visited" data-cat="Visited"><i class="bi bi-check-circle"></i> Visited</button>
        <button class="chooser-btn dreaming" data-cat="Dreaming"><i class="bi bi-cloud"></i> Dreaming</button>
      `;
      document.body.appendChild(chooser);

      function hideChooser(){ chooser.style.display='none'; }

      // Wire card add buttons
      document.querySelectorAll('.btn-add').forEach(btn => {
        btn.addEventListener('click', function(ev){
          ev.preventDefault();
          ev.stopPropagation();
          
          const card = ev.target.closest('.explore-card');
          
          // prefill hidden form fields
          document.getElementById('hidden_name').value = card.dataset.name || '';
          document.getElementById('hidden_city').value = card.dataset.city || '';
          document.getElementById('hidden_country').value = card.dataset.country || '';
          const img = card.querySelector('img');
          if (img) document.getElementById('hidden_image').value = img.getAttribute('src');

          // Position chooser
          const rect = ev.target.getBoundingClientRect();
          const scrollY = window.scrollY || window.pageYOffset;
          
          chooser.style.top = (rect.bottom + scrollY + 5) + 'px';
          // Align right edge of chooser with right edge of button
          chooser.style.left = (rect.left - 80) + 'px'; 
          chooser.style.display = 'flex';
        });
      });

      // Handle Selection
      chooser.addEventListener('click', function(ev){
        const btn = ev.target.closest('.chooser-btn');
        if(!btn) return;
        const cat = btn.dataset.cat;

        document.getElementById('hidden_category').value = cat;
        document.getElementById('hidden_add_form').submit();
      });

      // Hide when clicking outside
      document.addEventListener('click', function(ev){
        if(!chooser.contains(ev.target) && !ev.target.classList.contains('btn-add')){
          hideChooser();
        }
      });
    })();
  </script>

</body>
</html>