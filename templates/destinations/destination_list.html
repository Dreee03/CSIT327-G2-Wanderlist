{% extends "dashboard_base.html" %}
{% load tz %}
{% load humanize %}

{% block content %}
<div class="container py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">üìå My Destinations</h2>
    <a href="{% url 'destination_create' %}" class="btn btn-primary shadow-sm">
      ‚ûï Add Destination
    </a>
  </div>

  <!-- Table Card -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle text-center mb-0">
          <thead class="table-dark">
            <tr>
              <th>Name</th>
              <th>Country</th>
              <th>Status</th>
              <th>Created</th>
              <th>Last Updated</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            {% for destination in destinations %}
            <tr>
              <!-- Destination Name -->
              <td>
                <strong>{{ destination.name|default:"Unnamed Destination" }}</strong>
              </td>

              <!-- Country (Full Name) -->
              <td>
                {% if destination.location %}
                  {{ destination.location.name|default:"Unknown" }}
                {% else %}
                  <span class="text-muted">Not specified</span>
                {% endif %}
              </td>

              <!-- Status -->
              <td>
                {% if destination.status == "Wishlist" %}
                  <span class="badge bg-warning text-dark px-3 py-2">Wishlist</span>
                {% elif destination.status == "Vacation" %}
                  <span class="badge bg-info text-dark px-3 py-2">Vacation</span>
                {% elif destination.status == "Visited" %}
                  <span class="badge bg-success px-3 py-2">Visited</span>
                {% else %}
                  <span class="badge bg-secondary px-3 py-2">Unknown</span>
                {% endif %}
              </td>

              <!-- Created (Always Philippine Local Time) -->
              <td>
                {% timezone "Asia/Manila" %}
                  {{ destination.created_at|date:"M d, Y ‚Ä¢ h:i A" }}
                {% endtimezone %}
                <br>
                <small class="text-muted">
                  ({{ destination.created_at|naturaltime }})
                </small>
              </td>

              <!-- Updated (Show latest if changed, otherwise same as created) -->
              <td>
                {% timezone "Asia/Manila" %}
                  {% if destination.updated_at and destination.updated_at|date:"U" != destination.created_at|date:"U" %}
                    <span class="text-success fw-semibold">
                      {{ destination.updated_at|date:"M d, Y ‚Ä¢ h:i A" }}
                    </span>
                    <br>
                    <small class="text-muted">
                      ({{ destination.updated_at|naturaltime }})
                    </small>
                  {% else %}
                    <span class="text-muted">
                      {{ destination.created_at|date:"M d, Y ‚Ä¢ h:i A" }}
                    </span>
                    <br>
                    <small class="text-muted">
                      (Same as created)
                    </small>
                  {% endif %}
                {% endtimezone %}
              </td>

              <!-- Actions -->
              <td>
                <a href="{% url 'destination_update' destination.pk %}" class="btn btn-sm btn-outline-primary me-2">
                  ‚úèÔ∏è Edit
                </a>
                <a href="{% url 'destination_delete' destination.pk %}" 
                   class="btn btn-sm btn-outline-danger"
                   onclick="return confirm('Are you sure you want to delete this destination?');">
                  üóë Delete
                </a>
              </td>
            </tr>

            {% empty %}
            <tr>
              <td colspan="6" class="text-center text-muted py-5">
                üåç No destinations added yet.  
                <a href="{% url 'destination_create' %}" class="text-decoration-none fw-semibold">
                  Add one now!
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Table Row Hover Effect -->
<style>
  table.table-hover tbody tr:hover {
    background-color: #f8f9fa !important;
    transition: background-color 0.3s ease;
  }
  small.text-muted {
    font-size: 0.85em;
  }
</style>
{% endblock %}
